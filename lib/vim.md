# Vim编辑器

标签（空格分隔）： Linux基础

---

程序开发工具，vi的进阶版本

## vi使用

分为三种模式

* 命令模式：一开始进入的模式，可以移动光标、删除字符、复制粘贴
* 编辑模式：输入`i, o, a, r`进入编辑模式，可以编辑文件，按`ESC`回到命令模式
* 命令行模式：输入`:, /, ?`进入命令行模式，可以搜索、保存、离开，按`ESC`回到命令模式

![vim快捷键](https://raw.githubusercontent.com/wchaochao/images/master/gitbook-linux-base/vim-shortcut.jpg)

## 命令模式

### 进入

```bash
# 创建新文件或打开文件
vi <file>
```

### 字符移动

| 按键 | 操作 |
| --- | --- |
| 方向键/HJKL | 向某个方向移动一个字符 |
| n + 方向键/HJKL | 向某个方向移动n个字符 |
| 空白键 | 向右移动一个字符 |
| n + 空白键 | 向右移动n个字符 |

### 特定字符移动

| 按键 | 操作 |
| --- | --- |
| 0/Home | 移动到行首 |
| $/End | 移动到行尾 |
| ^ | 移动到行首非空白字符 |
| g_ | 移动到行尾非空白字符 |
| % | 移动到当前行括号处 |
| f<char>/F<char> | 移动到下一个/上一个char字符 |
| t<char>/T<char> | 移动到下一个/上一个char字符前 |

### 单词移动

| 按键 | 操作 |
| --- | --- |
| w/W | 移动到下一个单词开头（大写以空白符分隔单词，小写单词为字母数字下划线） |
| e/E | 移动到下一个单词结尾（大写以空白符分隔单词，小写单词为字母数字下划线） |
| # | 移动到上一个光标所在的单词 |
| * | 移动到下一个光标所在的单词 |

### 行移动

| 按键 | 操作 |
| --- | --- |
| + | 移动到下一行非空白处 |
| - | 移动到上一行非空白处 |
| n + Enter | 向下移动n行 |
| gg | 移动到第一行 |
| G | 移动到最后一行 |
| n + G | 移动到第n行 |

### 页移动

| 按键 | 操作 |
| --- | --- |
| H | 移动到当前页的开头 |
| M | 移动到当前页的中间 |
| L | 移动到当前页的结尾 |
| Ctrl + d | 向下移动半页 |
| Ctrl + u | 向上移动半页 |
| Ctrl + f | 向下移动一页 |
| Ctrl + b | 向上移动一页 |

### 剪切

| 按键 | 操作 |
| --- | --- |
| x | 向后剪切一个字符 |
| X | 向前剪切一个字符 |
| n + x | 向后剪切n个字符 |
| d0 | 剪切光标到行首的字符 |
| d$ | 剪切光标到行尾的字符 |
| dd | 剪切当前行 |
| n + dd | 向下剪切n行（包括当前行） |
| d1G | 剪切光标所在行到第一行的字符 |
| dG | 剪切光标所在行到最后一行的字符 |

### 复制

| 按键 | 操作 |
| --- | --- |
| y0 | 复制光标到行首的字符 |
| y$ | 复制光标到行尾的字符 |
| yy | 复制当前行 |
| n + yy | 向下复制n行（包括当前行） |
| y1G | 复制光标所在行到第一行的字符 |
| yG | 复制光标所在行到最后一行的字符 |

### 粘贴

| 按键 | 操作 |
| --- | --- |
| p | 当前光标后粘贴 |
| P | 当前光标前粘贴 |

### 选中

| 按键 | 操作 |
| --- | --- |
| v | 选中字符 |
| V | 选中行 |
| Ctrl + V | 选中块 |
| d | 剪切选中的 |
| y | 复制选中的 |
| p | 粘贴选中的 |
| J | 变为一行 |
| gU | 变大写 |
| gu | 变小写 |
| < | 左缩进 |
| > | 右缩进 |
| = | 自动缩进 |

### 区域操作

`<action>a<object>`或`<action>i<object>`

action

| 按键 | 操作 |
| --- | --- |
| d | 剪切 |
| y | 复制 |
| v | 选中 |

object

| 按键 | 操作 |
| --- | --- |
| w | 单词 |
| W | 以空格为分隔的单词 |
| s | 句子 |
| p | 段落 |
| <char> | 某个字符 |

### 重复

| 按键 | 操作 |
| --- | --- |
| . | 重复上次命令 |
| n + <command> | 重复操作n次 |

### 撤销

| 按键 | 操作 |
| --- | --- |
| u | 撤销 |
| Ctrl + r | 反撤销 |
| J | 将当前行和下一行合并 |

## 编辑模式

### 进入

| 按键 | 操作 |
| --- | --- |
| i | 在光标处插入 |
| I | 在光标所在行的行首非空白处插入 |
| a | 在光标后插入 |
| A | 在光标所在行的行尾处插入 |
| o | 向下插入 |
| O | 向上插入 |
| r | 替换一次光标处的字符 |
| R | 一直替换光标处的字符 |
| cw | 替换光标到单词结尾处 |

### 退出

| 按键 | 操作 |
| --- | --- |
| Esc | 退出 |

## 命令行模式

### 保存

| 按键 | 操作 |
| --- | --- |
| :w | 保存 |
| :w! | 强制保存 |
| :q | 无改动离开 |
| :q! | 有改动强制离开 |
| :wq | 保存并离开 |
| :wq! | 强制保存并离开 |
| ZZ | 无改动直接离开，有改动保存并离开 |
| :w filename | 另存为 |
| :n1,n2 w filename | 将第n1行到n2行的内容另存为 |
| :r filename | 读取文件内容添加到下一行 |

### 查找

| 按键 | 操作 |
| --- | --- |
| /word | 向下查找word |
| ?word | 向上查找word |
| n | 正向查找下一个 |
| N | 反向查找下一个 |

### 替换

| 按键 | 操作 |
| --- | --- |
| :n1,n2s/word1/word2/g | 将第n1行到第n2行的word1替换成word2 |
| :1,$s/word1/word2/g | 将第一行到最后一行的word1替换成word2 |
| :1,$s/word1/word2/gc | 将第一行到最后一行的word1替换成word2，并在替换时进行确认 |

### 其他

| 按键 | 操作 |
| --- | --- |
| :e! | 还原为初始状态 |
| :!command | 暂时离开vi到命令行界面执行command |
| Esc | 退出 |

## vim额外功能

### 代码补全

| 按键 | 操作 |
| --- | --- |
| Ctrl + x, Ctrl + n | 根据文件内容补全 |
| Ctrl + x, Ctrl + o | 根据文件扩展名补全 |

### 多文件编辑

编辑多个文件

```bash
vim <...file>
```

| 按键 | 操作 |
| --- | --- |
| :files | 查看编辑的文件 |
| :n | 编辑下一个文件 |
| :N | 编辑上一个文件 |

### 多窗口编辑

| 按键 | 操作 |
| --- | --- |
| :sp | 打开新窗口，显示原文件 |
| :sp filename | 打开新窗口，显示filename |
| Ctrl + w + j/Down | 光标移动到下一个窗口 |
| Ctrl + w + k/Up | 光标移动到上一个窗口 |
| :q | 离开窗口 |

### vim设置

设置单个文件

| 按键 | 操作 |
| --- | --- |
| :set nu | 设置行号 |
| :set nonu | 取消行号 |
| :set hlsearch | 设置搜索高亮 |
| :set nohlsearch | 取消搜索高亮 |
| :set autoindent | 设置自动缩排 |
| :set noautoindent | 取消自动缩排 |
| :set backup | 设置自动备份 |
| :set nobackup | 取消自动备份 |
| :set bg=dark/light | 设置背景颜色 |
| :set all | 显示当前文件的所有设置参数 |
| :set | 显示当前文件的所有与默认值不同的设置参数 |
| :syntax on | 设置代码高亮 |
| :syntax off | 取消代码高亮 |

配置文件设置

```bash
vim ~/.vimrc

"这个文件的双引号 （"） 是注解
set hlsearch            "高亮度反白
set backspace=2         "可随时用倒退键删除
set autoindent          "自动缩排
set ruler               "可显示最后一列的状态
set showmode            "左下角那一列的状态
set nu                  "可以在每一列的最前面显示行号啦！
set bg=dark             "显示不同的底色色调
syntax on               "进行语法检验，颜色显示。
```

### 其他

* 救援：vim在编辑文件时会额外创建一个filename.swap文件用于在vim被不正常关闭时恢复未保存数据
* 行为记录：vim会将编辑行为记录在~/.viminfo中

## 可能的问题

### 编码

需要保证文件编码和终端编码一致

```bash
# 查看所有编码
iconv -l

# 编码转换
iconv -f <origin-encode> -t <new-encode> filename

# 编码转换，并输出到新文件
iconv -f <origin-encode> -t <new-encode> filename -o <newfile>
```

### 换行符

* Windows的换行符为CRLF
* Linux的换行符为LF

```bash
# 将CRLF转换为LF
dos2unix file

# 将CRLF转换为LF，并输出到新文件
dos2unix -n file <newfile>

# 将LF转换为CRLF
unix2dos file

# 将LF转换为CRLF，并输出到新文件
unix2dos -n file <newfile>
```
